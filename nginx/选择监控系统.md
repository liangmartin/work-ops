# 监控系统的选择



# 关于zabbix

## **Zabbix**

```
Zabbix 是由 Alexei Vladishev 开源的分布式监控系统，支持多种采集方式和采集客户端，同时支持 SNMP、IPMI、JMX、Telnet、SSH 等多种协议。它将采集到的数据存放到数据库中，然后对其进行分析整理，如果符合告警规则，则触发相应的告警。

Zabbix 核心组件主要是 Agent 和 Server。其中 **Agent 主要负责采集数据并通过主动或者被动的方式将采集数据发送到 Server/Proxy**。除此之外，为了扩展监控项，Agent 还支持执行自定义脚本。**Server 主要负责接收 Agent 发送的监控信息，并进行汇总存储、触发告警等**。

Zabbix Server 将收集的监控数据存储到 Zabbix Database 中。Zabbix Database 支持常用的关系型数据库，如 MySQL、PostgreSQL、Oracle 等（默认是 MySQL），并提供 Zabbix Web 页面（PHP 编写）数据查询。

由于使用了关系型数据存储时序数据，**Zabbix在监控大规模集群时常常在数据存储方面捉襟见肘**。所以从 4.2 版本后 Zabbix开始支持 TimescaleDB 时序数据库，不过目前成熟度还不高。
```



# 关于granafa

## **Granafa**

```
**Graph**：这是基于 RRD 的数据上报、归档、存储组件。Graph 在收到数据以后，会以 rrdtool 的数据归档方式来存储，同时提供 RPC 方式的监控查询接口。
```



# 关于普罗米修斯

## 普罗米修斯

```
Prometheus 的基本原理是通过 HTTP 周期性抓取被监控组件的状态**。任意组件只要提供对应的 HTTP 接口并且符合 Prometheus 定义的数据格式，就可以接入 Prometheus 监控。

Prometheus Server 负责定时在目标上抓取 metrics（指标）数据并保存到本地存储。它采用了一种 Pull（拉）的方式获取数据，不仅降低客户端的复杂度，客户端只需要采集数据，无需了解服务端情况，也让服务端可以更加方便地水平扩展。

如果监控数据达到告警阈值，Prometheus Server 会通过 HTTP 将告警发送到告警模块 alertmanger，通过告警的抑制后触发邮件或者 Webhook。Prometheus 支持 PromQL 提供多维度数据模型和灵活的查询，通过监控指标关联多个 tag 的方式，将监控数据进行任意维度的组合以及聚合。
```





![image-20221117100319231](C:\Users\Administrator\Desktop\md文件\images\image-20221117100319231.png)

# zabbix与普罗米修斯的区别

## 1.从系统成熟度上看

zabbix是老牌的系统，而普罗米修斯是站在巨人肩膀上的成果，在架构设计上借鉴了很多老牌监控系统的经验。



## 2.从系统扩展性方面看

**zabbix**：可以自定义各种监控脚本，而且zabbix支持主动方式与被动方式获取监控。

**Prometheus** ：定义了一套监控数据规范，并通过各种 exporter 扩展系统采集能力。Prometheus相当于一整个ELK，但不适合存储大量日志，也不适合长期存储（默认15天）。它的优点是可以查看最近的趋势数据，还有一个报警机制。



## 3.**从数据存储方面来看**



|        | zabbix                   | prometheus                                                   |
| ------ | ------------------------ | ------------------------------------------------------------ |
| 数据库 | 关系数据库               | 时序数据库                                                   |
|        | 限制了 Zabbix 的采集性能 | 每秒千万级别的数据存储，通过对接第三方时序数据库扩展历史数据的存储 |
|        |                          |                                                              |







普罗米修斯采集对象

![image-20221117154257817](C:\Users\Administrator\Desktop\md文件\images\image-20221117154257817.png)



普罗米修斯的特点普罗米修斯不足

1、Prometheus主要是做性能和可用性监控，不适合监控日志（Log）、事件（Event）、调用链（Tracing）等。

2、重点是最近的数据，默认保存15天（1个月）的监控数据。



![image-20221117102922777](C:\Users\Administrator\Desktop\md文件\images\image-20221117102922777.png)



## 4.**从配置复杂度上**

zabbix 前期配置容易，后期配置会复杂

Prometheus 只有一个核心 server 组件，一条命令便可以启动，前期配置可能会繁琐，后期简单。

```
Prometheus 通过 HTTP 接口的方式从各种客户端获取数据，这些客户端必须符合 Prometheus 监控数据格式。通常它有两种方式，一种是侵入式埋点监控，通过在客户端引入Prometheus go client，提供 /metrics 接口查询 Kubernetes API 各种指标。另一种是通过 exporter 方式，在外部将原来各种中间件的监控支持转化为 Prometheus 的监控数据格式，如 Redis Exporter 将 Redis 指标转化为 Prometheus 能够识别的 HTTP 请求。Prometheus 并没有采用 JSON 的数据格式，而是采用 text/plain 纯文本的方式 ，这是它的特殊之处。HTTP 返回 Header 和 Body 如上图所示，指标前面两行 # 是注释，标识指标的含义和类型。指标和指标的值通过空格分割，开发者通常不需要自己拼接这种个数的数据， Prometheus 提供了各种语言的 SDK 支持。
```







|            | zabbix                                                       | 普罗米修斯                                                   |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 系统成熟度 | 老牌的系统                                                   | 巨人肩膀上的成果                                             |
| 系统扩展性 | 自定义各种监控脚本，而且zabbix支持主动方式与被动方式获取监控 | 定义了一套监控数据规范，并通过各种 exporter 扩展系统采集能力。Prometheus相当于一整个ELK，但不适合存储大量日志，也不适合长期存储（默认15天）。它的优点是可以查看最近的趋势数据，还有一个报警机制。 |
| 数据存储   | 关系型数据库限制了zabbix的采集性能                           | 每秒千万级别的数据存储，通过对接第三方时序数据库扩展历史数据的存储 |
| 配置复杂度 | zabbix前期配置容易，后期配置复杂                             | 普罗米修斯只有一个核心server组件，一条命令就可以启动，前期配置繁琐后期简单。 |







